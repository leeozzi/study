
# 🔐 JWT 서명 키 생성 메서드 비교 (`hmacShaKeyFor`, `secretKeyFor`, `keyPairFor`)

JWT 서명에 사용되는 키 생성 메서드는 대표적으로 세 가지가 있으며, 각각 용도와 보안 방식이 다릅니다.  
아래에 각 방식의 차이점과 사용법을 정리합니다.

---

## 🧩 요약 비교표

| 메서드 이름         | 사용 알고리즘             | 키 종류         | 특징 |
|---------------------|----------------------------|------------------|------|
| `hmacShaKeyFor()`   | HS256/HS384/HS512 (대칭키) | 비밀키 1개       | 서버에서만 검증, 가장 흔한 방식 |
| `secretKeyFor()`    | HS 계열 등 (대칭키)        | 랜덤 비밀키 1개  | 자동 랜덤 생성, 앱 재시작 시 키 변경됨 |
| `keyPairFor()`      | RS256/ES256 (비대칭키)     | 공개키/개인키 쌍 | 외부 공개 검증 가능, 복잡도 높음 |

---

## 1️⃣ `hmacShaKeyFor(byte[])`

> 문자열 기반 비밀키를 직접 입력하여 **HS256 계열** 서명을 수행합니다.  
> **실무에서 가장 많이 사용되는 방식입니다.**

### ✅ 예시
```java
String secret = "너의매우매우긴시크릿키1234567890";
Key key = Keys.hmacShaKeyFor(secret.getBytes());
```

### ✅ 특징
- `HS256`, `HS384`, `HS512` 등 HMAC 기반 대칭키 알고리즘에 사용
- 서버 간 동일한 시크릿 키를 공유하면 문제없이 동작
- 키가 유출되면 공격자가 토큰을 위조할 수 있으므로 **환경변수 또는 비밀 저장소 사용 필수**
- 토큰 생성과 검증을 모두 같은 키로 처리

---

## 2️⃣ `secretKeyFor(SignatureAlgorithm)`

> `jjwt` 라이브러리가 제공하는 **랜덤 비밀키 자동 생성기**  
> 테스트 용도로는 유용하지만, **키가 고정되지 않기 때문에 운영 환경에는 부적합**합니다.

### ✅ 예시
```java
Key key = Keys.secretKeyFor(SignatureAlgorithm.HS256);
```

### ⚠️ 특징
- 실행할 때마다 새로운 키가 생성됨
- 앱 재시작 시 기존 토큰이 무효화됨
- 테스트나 샘플 프로젝트에서는 OK
- 운영 환경에서는 ❌

---

## 3️⃣ `keyPairFor(SignatureAlgorithm)`

> 비대칭키 서명 알고리즘 (`RS256`, `ES256` 등)에서 사용하는 **공개키/개인키 쌍을 생성**합니다.  
> **OAuth2**, **SSO**, **외부 API와 연동** 시 권장됩니다.

### ✅ 예시
```java
KeyPair keyPair = Keys.keyPairFor(SignatureAlgorithm.RS256);
PrivateKey privateKey = keyPair.getPrivate(); // 서명용
PublicKey publicKey = keyPair.getPublic();   // 검증용
```

### ✅ 특징
- `RS256`, `RS512`, `ES256` 등 비대칭 알고리즘에 사용
- 개인키로 서명 → 공개키로 검증 가능
- **외부 시스템 또는 공개 API에서 토큰 검증이 가능**
- 공개키가 유출돼도 서명은 못 하므로 상대적으로 안전
- 단점: 구현과 키 관리가 복잡하고 성능도 약간 느림

---

## 🧠 언제 뭘 써야 할까?

| 상황 | 추천 메서드 |
|------|-------------|
| 단일 서버, 기본 로그인 인증 | `hmacShaKeyFor()` |
| 외부 서비스 또는 마이크로서비스 간 JWT 공유 필요 | `keyPairFor()` |
| 테스트/샘플 코드용 키 생성 | `secretKeyFor()` (운영 ❌) |

---

## ✅ 결론

- 운영 환경에서는 **`hmacShaKeyFor()` + 환경변수로 비밀키 관리**가 가장 안전하고 간단합니다.
- 외부 인증 서버가 JWT를 발급하고 여러 서비스에서 검증한다면 **`keyPairFor()` + RS256**이 권장됩니다.
- `secretKeyFor()`는 편리하지만 **토큰 유지가 불가능하므로 실서비스에 사용하면 안 됩니다.**
